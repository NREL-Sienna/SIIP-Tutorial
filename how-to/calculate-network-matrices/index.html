<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
   <link rel="stylesheet" href="/SIIP-Tutorial/libs/highlight/github.min.css">
   
  <link rel="stylesheet" href="/SIIP-Tutorial/css/franklin.css">
  <link rel="stylesheet" href="/SIIP-Tutorial/css/basic.css">
  <link rel="icon" href="/SIIP-Tutorial/assets/favicon.png">
  <title>SIIP Tutorial</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/1.33.1/plotly.min.js" integrity="sha512-V0j9LhrK9IMNdFYZqh+IqU4cjo7wdxyHNyH+L0td4HryBuZ7Oq6QxP2/CWr6TituX31+gv5PnolvERuTbz8UNA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
      const PlotlyJS_json = async (div, url) => {
        response = await fetch(url)
        fig = await response.json()
        if (typeof fig.config === 'undefined') { fig["config"]={} }
          delete fig.layout.width
          delete fig.layout.height
          fig["layout"]["autosize"] = true
          fig["config"]["autosizable"] = true
          fig["config"]["responsive"] = true
          fig.config["scrollZoom"] = false
          delete fig.config.staticPlot
          delete fig.config.displayModeBar
          delete fig.config.doubleClick
          delete fig.config.showTips
          Plotly.newPlot(div, fig);
      }
  </script>
</head>
<body>
  <header>
  <div class="blog-name"><a href="/SIIP-Tutorial/">SIIP Tutorial</a></div>
  <nav>
    <ul>
      <li><a href="/SIIP-Tutorial/">Home</a></li>
    </ul>
    <img src="/SIIP-Tutorial/assets/hamburger.svg" id="menu-icon" />
  </nav>
</header>



<div class="franklin-content" >
  <h1 id="using_powersystems_to_calculate_network_matrices" ><a href="#using_powersystems_to_calculate_network_matrices"> Using PowerSystems to calculate network matrices</a></h1><p><strong>Originally Contributed by</strong>: Clayton Barrows</p>
<h2 id="introduction" ><a href="#introduction"> Introduction</a></h2><p>PowerSystems.jl supports the calculation of several different matrix representations of
power system networks. This example demonstrates how to use PowerSystems.jl to calculate:</p>
<ul>
<li>Y bus</li>
<li>Power transfer distribution factor (PTDF)</li>
<li>Line outage distribution  factor (LODF)</li>
</ul>
<h3 id="dependencies" ><a href="#dependencies"> Dependencies</a></h3><p>Let's use a dataset from the <a href="https://nbviewer.jupyter.org/github/NREL-SIIP/SIIPExamples.jl/blob/master/notebook/2_PowerSystems_examples/parse_matpower.ipynb">tabular data parsing example</a></p>
<pre><code class="julia">using PowerSystems
using TimeSeries
base_dir = PowerSystems.download(PowerSystems.TestData; branch = &quot;master&quot;);
sys = System(joinpath(base_dir, &quot;matpower&quot;, &quot;case5_re.m&quot;))
sys</code></pre>
<div class="code-output"><pre><code class="code-stdout language-plaintext">┌ Error: Generator voltage set-points for bus 3 are inconsistent. This can lead to unexpected results
└ @ PowerSystems ~/.julia/packages/PowerSystems/zVsmd/src/parsers/pm_io/matpower.jl:245
┌ Error: Generator voltage set-points for bus 10 are inconsistent. This can lead to unexpected results
└ @ PowerSystems ~/.julia/packages/PowerSystems/zVsmd/src/parsers/pm_io/matpower.jl:245
</code></pre><table>
  <caption style = "text-align: left;">System</caption>
  <thead>
    <tr class = "header headerLastRow">
      <th style = "text-align: left;">Property</th>
      <th style = "text-align: left;">Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style = "text-align: left;">System Units Base</td>
      <td style = "text-align: left;">SYSTEM_BASE</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Base Power</td>
      <td style = "text-align: left;">100.0</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Base Frequency</td>
      <td style = "text-align: left;">60.0</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Num Components</td>
      <td style = "text-align: left;">30</td>
    </tr>
  </tbody>
</table>

<table>
  <caption style = "text-align: left;">Static Components</caption>
  <thead>
    <tr class = "header headerLastRow">
      <th style = "text-align: left;">Type</th>
      <th style = "text-align: left;">Count</th>
      <th style = "text-align: left;">Has Static Time Series</th>
      <th style = "text-align: left;">Has Forecasts</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style = "text-align: left;">Arc</td>
      <td style = "text-align: left;">6</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Area</td>
      <td style = "text-align: left;">1</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Bus</td>
      <td style = "text-align: left;">5</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Line</td>
      <td style = "text-align: left;">5</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">LoadZone</td>
      <td style = "text-align: left;">1</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">PhaseShiftingTransformer</td>
      <td style = "text-align: left;">2</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">PowerLoad</td>
      <td style = "text-align: left;">3</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">RenewableDispatch</td>
      <td style = "text-align: left;">2</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">ThermalStandard</td>
      <td style = "text-align: left;">5</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">false</td>
    </tr>
  </tbody>
</table>

</div><h3 id="ybus" ><a href="#ybus"> Ybus</a></h3><pre><code class="julia">ybus = Ybus(sys)</code></pre>
<div class="code-output"><pre><code class="code-result language-plaintext">PowerNetworkMatrix
    Dimension 1, [1, 2, 3, 4, 10]
    Dimension 2, [1, 2, 3, 4, 10]
And data, a (5, 5):
  22.2507-222.484im  -3.52348+35.2348im           ⋅           -3.2569+32.569im   -15.4703+154.703im
 -3.52348+35.2348im   12.6911-126.898im  -9.16758+91.6758im           ⋅                   ⋅    
          ⋅          -9.16758+91.6758im    15.525-155.247im  -7.45707+63.3779im           ⋅    
  -3.2569+32.569im            ⋅          -5.24067+63.5996im    12.948-129.473im  -3.33367+33.3367im
 -15.4703+154.703im           ⋅                   ⋅          -3.33367+33.3367im    18.804-188.021im</code></pre></div><h3 id="ptdf" ><a href="#ptdf"> PTDF</a></h3><pre><code class="julia">ptdf = PTDF(sys)</code></pre>
<div class="code-output"><pre><code class="code-result language-plaintext">PowerNetworkMatrix
    Dimension 1, ["bus1-bus2-i_1", "bus1-bus4-i_2", "bus1-bus5-i_3", "bus2-bus3-i_4", "bus3-bus4-i_6", "bus3-bus4-i_5", "bus4-bus5-i_7"]
    Dimension 2, [1, 2, 3, 4, 10]
And data, a (7, 5):
  0.23245   -0.37175   -0.219627  0.0   0.19124
  0.41667    0.201807   0.119226  0.0   0.342801
  0.35088    0.169943   0.100401  0.0  -0.53404
  0.23245    0.62825   -0.219627  0.0   0.19124
  0.116225   0.314125   0.390186  0.0   0.0956199
  0.116225   0.314125   0.390186  0.0   0.0956199
 -0.35088   -0.169943  -0.100401  0.0  -0.46596</code></pre></div><h3 id="lodf" ><a href="#lodf"> LODF</a></h3><pre><code class="julia">lodf = LODF(sys)</code></pre>
<div class="code-output"><pre><code class="code-result language-plaintext">PowerNetworkMatrix
    Dimension 1, ["bus1-bus2-i_1", "bus1-bus4-i_2", "bus1-bus5-i_3", "bus2-bus3-i_4", "bus3-bus4-i_6", "bus3-bus4-i_5", "bus4-bus5-i_7"]
    Dimension 2, ["bus1-bus2-i_1", "bus1-bus4-i_2", "bus1-bus5-i_3", "bus2-bus3-i_4", "bus3-bus4-i_6", "bus3-bus4-i_5", "bus4-bus5-i_7"]
And data, a (7, 7):
 -1.0        0.398488   0.3581   -1.0       -0.360154  -0.360154  -0.3581
  0.542857  -1.0        0.6419    0.542857   0.195512   0.195512  -0.6419
  0.457143   0.601512  -1.0       0.457143   0.164642   0.164642   1.0
 -1.0        0.398488   0.3581   -1.0       -0.360154  -0.360154  -0.3581
 -0.5        0.199244   0.17905  -0.5       -1.0        0.639846  -0.17905
 -0.5        0.199244   0.17905  -0.5        0.639846  -1.0       -0.17905
 -0.457143  -0.601512   1.0      -0.457143  -0.164642  -0.164642  -1.0</code></pre></div><h3 id="indexing" ><a href="#indexing"> Indexing</a></h3><p>Note that the axes of these matrices that correspond to buses are indexed by bus number
(<code>::Int64</code>) while the branch axes are indexed by branch name (<code>::String</code>). You can access
specific elements of the matrices as follows:</p>
<pre><code class="julia">ptdf[&quot;bus3-bus4-i_6&quot;, 3]</code></pre>
<div class="code-output"><pre><code class="code-result language-plaintext">0.39018648100730935</code></pre></div><p>Additionally, PowerSystems provides accessors to the network matrices that take <code>Componets</code>
as arguments so that you can pass references to the components themselves rather than the
name or number. For example:</p>
<pre><code class="julia">buses = collect(get_components(Bus, sys))
ybus[buses[1], buses[2]]</code></pre>
<div class="code-output"><pre><code class="code-result language-plaintext">-3.2569046378322044 + 32.56904637832204im</code></pre></div><p>If you would instead like to index by bus name, something like the following should work:</p>
<pre><code class="julia">busname2num = get_components(Bus, sys) |&gt; (c -&gt; Dict(zip(get_name.(c), get_number.(c))))
ptdf[&quot;bus3-bus4-i_6&quot;, busname2num[&quot;bus3&quot;]]</code></pre>
<div class="code-output"><pre><code class="code-result language-plaintext">0.39018648100730935</code></pre></div>
  <div class="page-foot">
  <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>
  "Dheepak Krishnamurthy".  Last modified: August 25, 2022. Website built with
  <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the
  <a href="https://julialang.org">Julia programming language</a>.
</div>

<script>
  var coll = document.getElementsByClassName('collapsible')
  var i

  for (i = 0; i < coll.length; i++) {
    coll[i].addEventListener('click', function () {
      this.classList.toggle('active')
      var content = this.nextElementSibling
      if (content.style.display === 'block') {
        content.style.display = 'none'
      } else {
        content.style.display = 'block'
      }
    })
  }
</script>



<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.4.0/clipboard.min.js"></script>

<script>
  ;(function () {
    // Get the elements.
    // - the 'pre' element.
    // - the 'div' with the 'paste-content' id.

    var pre = document.getElementsByTagName('pre')

    // Add a copy button in the 'pre' element.
    // which only has the className of 'language-'.

    for (var i = 0; i < pre.length; i++) {
      var isResult = pre[i].children[0].className.indexOf('code-result')
      var isStdout = pre[i].children[0].className.indexOf('code-stdout')

      if (isResult !== 0 && isStdout !== 0) {
        var button = document.createElement('button')
        button.className = 'copy-button'
        button.textContent = 'Copy'

        pre[i].prepend(button)
      }
    }

    // Run Clipboard

    var copyCode = new Clipboard('.copy-button', {
      target: function (trigger) {
        return trigger.nextElementSibling
      },
    })

    // On success:
    // - Change the "Copy" text to "Copied".
    // - Swap it to "Copy" in 2s.
    // - Lead user to the "contenteditable" area with Velocity scroll.

    copyCode.on('success', function (event) {
      event.clearSelection()
      event.trigger.textContent = 'Copied'
      window.setTimeout(function () {
        event.trigger.textContent = 'Copy'
      }, 2000)
    })

    // On error (Safari):
    // - Change the  "Press Ctrl+C to copy"
    // - Swap it to "Copy" in 2s.

    copyCode.on('error', function (event) {
      event.trigger.textContent = 'Press "Ctrl + C" to copy'
      window.setTimeout(function () {
        event.trigger.textContent = 'Copy'
      }, 5000)
    })
  })()
</script>

</div>

    
    
        <script src="/SIIP-Tutorial/libs/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>

    
  </body>

</html>
