<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
   <link rel="stylesheet" href="/SIIP-Tutorial/libs/highlight/github.min.css">
   
  <link rel="stylesheet" href="/SIIP-Tutorial/css/franklin.css">
  <link rel="stylesheet" href="/SIIP-Tutorial/css/basic.css">
  <link rel="icon" href="/SIIP-Tutorial/assets/favicon.png">
  <title>SIIP Tutorial</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/1.33.1/plotly.min.js" integrity="sha512-V0j9LhrK9IMNdFYZqh+IqU4cjo7wdxyHNyH+L0td4HryBuZ7Oq6QxP2/CWr6TituX31+gv5PnolvERuTbz8UNA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
      const PlotlyJS_json = async (div, url) => {
        response = await fetch(url)
        fig = await response.json()
        if (typeof fig.config === 'undefined') { fig["config"]={} }
          delete fig.layout.width
          delete fig.layout.height
          fig["layout"]["autosize"] = true
          fig["config"]["autosizable"] = true
          fig["config"]["responsive"] = true
          fig.config["scrollZoom"] = false
          delete fig.config.staticPlot
          delete fig.config.displayModeBar
          delete fig.config.doubleClick
          delete fig.config.showTips
          Plotly.newPlot(div, fig);
      }
  </script>
</head>
<body>
  <header>
  <div class="blog-name"><a href="/SIIP-Tutorial/">SIIP Tutorial</a></div>
  <nav>
    <ul>
      <li><a href="/SIIP-Tutorial/">Home</a></li>
    </ul>
    <img src="/SIIP-Tutorial/assets/hamburger.svg" id="menu-icon" />
  </nav>
</header>



<div class="franklin-content" >
  <h1 id="selective_flow_constraints_with_powersimulations.jl" ><a href="#selective_flow_constraints_with_powersimulations.jl"> Selective flow constraints with PowerSimulations.jl</a></h1><p><strong>Originally Contributed by</strong>: Clayton Barrows and Sourabh Dalvi</p>
<h2 id="introduction" ><a href="#introduction"> Introduction</a></h2><p>The <a href="https://nbviewer.jupyter.org/github/NREL-SIIP/SIIPExamples.jl/blob/master/notebook/3_PowerSimulations_examples/02_sequential_simulations.ipynb">Operations Problems example</a>
shows the basic building blocks of building optimization problems with PowerSimulations.jl.
This example shows how to customize the enforcement of branch flow constraints as is common
when trying to build large scale simulations.</p>
<h2 id="dependencies" ><a href="#dependencies"> Dependencies</a></h2><h3 id="modeling_packages" ><a href="#modeling_packages"> Modeling Packages</a></h3><pre><code class="julia">using PowerSystems
using PowerSimulations
using PowerSystemCaseBuilder</code></pre>
<h3 id="optimization_packages" ><a href="#optimization_packages"> Optimization packages</a></h3><p>For this simple example, we can use the HiGHS solver with a relatively relaxed tolerance.</p>
<pre><code class="julia">using HiGHS # mip solver
solver = optimizer_with_attributes(HiGHS.Optimizer, &quot;mip_rel_gap&quot; =&gt; 0.5)</code></pre>
<div class="code-output"><pre><code class="code-result language-plaintext">MathOptInterface.OptimizerWithAttributes(HiGHS.Optimizer, Pair{MathOptInterface.AbstractOptimizerAttribute, Any}[MathOptInterface.RawOptimizerAttribute("mip_rel_gap") => 0.5])</code></pre></div><h3 id="create_a_system_from_rts_gmlc_data" ><a href="#create_a_system_from_rts_gmlc_data"> Create a <code>System</code> from RTS-GMLC data</a></h3><pre><code class="julia">sys = build_system(PSITestSystems, &quot;modified_RTS_GMLC_DA_sys&quot;)</code></pre>
<div class="code-output"><table>
  <caption style = "text-align: left;">System</caption>
  <thead>
    <tr class = "header headerLastRow">
      <th style = "text-align: left;">Property</th>
      <th style = "text-align: left;">Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style = "text-align: left;">System Units Base</td>
      <td style = "text-align: left;">SYSTEM_BASE</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Base Power</td>
      <td style = "text-align: left;">100.0</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Base Frequency</td>
      <td style = "text-align: left;">60.0</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Num Components</td>
      <td style = "text-align: left;">500</td>
    </tr>
  </tbody>
</table>

<table>
  <caption style = "text-align: left;">Static Components</caption>
  <thead>
    <tr class = "header headerLastRow">
      <th style = "text-align: left;">Type</th>
      <th style = "text-align: left;">Count</th>
      <th style = "text-align: left;">Has Static Time Series</th>
      <th style = "text-align: left;">Has Forecasts</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style = "text-align: left;">Arc</td>
      <td style = "text-align: left;">109</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Area</td>
      <td style = "text-align: left;">3</td>
      <td style = "text-align: left;">true</td>
      <td style = "text-align: left;">true</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Bus</td>
      <td style = "text-align: left;">73</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">FixedAdmittance</td>
      <td style = "text-align: left;">3</td>
      <td style = "text-align: left;">true</td>
      <td style = "text-align: left;">true</td>
    </tr>
    <tr>
      <td style = "text-align: left;">HydroDispatch</td>
      <td style = "text-align: left;">1</td>
      <td style = "text-align: left;">true</td>
      <td style = "text-align: left;">true</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Line</td>
      <td style = "text-align: left;">105</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">LoadZone</td>
      <td style = "text-align: left;">21</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">PowerLoad</td>
      <td style = "text-align: left;">51</td>
      <td style = "text-align: left;">true</td>
      <td style = "text-align: left;">true</td>
    </tr>
    <tr>
      <td style = "text-align: left;">RenewableDispatch</td>
      <td style = "text-align: left;">29</td>
      <td style = "text-align: left;">true</td>
      <td style = "text-align: left;">true</td>
    </tr>
    <tr>
      <td style = "text-align: left;">RenewableFix</td>
      <td style = "text-align: left;">31</td>
      <td style = "text-align: left;">true</td>
      <td style = "text-align: left;">true</td>
    </tr>
    <tr>
      <td style = "text-align: left;">TapTransformer</td>
      <td style = "text-align: left;">15</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">ThermalStandard</td>
      <td style = "text-align: left;">54</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">VariableReserve{PowerSystems.ReserveDown}</td>
      <td style = "text-align: left;">1</td>
      <td style = "text-align: left;">true</td>
      <td style = "text-align: left;">true</td>
    </tr>
    <tr>
      <td style = "text-align: left;">VariableReserve{PowerSystems.ReserveUp}</td>
      <td style = "text-align: left;">4</td>
      <td style = "text-align: left;">true</td>
      <td style = "text-align: left;">true</td>
    </tr>
  </tbody>
</table>

<table>
  <caption style = "text-align: left;">Time Series Summary</caption>
  <thead>
    <tr class = "header headerLastRow">
      <th style = "text-align: left;">Property</th>
      <th style = "text-align: left;">Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style = "text-align: left;">Components with time series data</td>
      <td style = "text-align: left;">123</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Total StaticTimeSeries</td>
      <td style = "text-align: left;">124</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Total Forecasts</td>
      <td style = "text-align: left;">124</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Resolution</td>
      <td style = "text-align: left;">60 minutes</td>
    </tr>
    <tr>
      <td style = "text-align: left;">First initial time</td>
      <td style = "text-align: left;">2020-01-01T00:00:00</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Last initial time</td>
      <td style = "text-align: left;">2020-12-30T00:00:00</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Horizon</td>
      <td style = "text-align: left;">48</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Interval</td>
      <td style = "text-align: left;">1440 minutes</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Forecast window count</td>
      <td style = "text-align: left;">365</td>
    </tr>
  </tbody>
</table>
</div><h3 id="selecting_flow_limited_lines" ><a href="#selecting_flow_limited_lines"> Selecting flow limited lines</a></h3><p>Since PowerSimulations will apply constraints by component type (e.g. Line), we need to
change the component type of the lines on which we want to enforce flow limits. So, let's
change the device type of certain branches from Line to MonitoredLine differentiate
treatment when we build the model. Here, we can select inter-regional lines, or lines
above a voltage threshold.</p>
<pre><code class="julia">for line in get_components(Line, sys)
    if (get_base_voltage(get_from(get_arc(line))) &gt;= 230.0) &amp;&amp;
       (get_base_voltage(get_to(get_arc(line))) &gt;= 230.0)
        # if get_area(get_from(get_arc(line))) != get_area(get_to(get_arc(line)))
        @info &quot;Changing $(get_name(line)) to MonitoredLine&quot;
        convert_component!(MonitoredLine, line, sys)
    end
end</code></pre>
<p>Let's start with a standard unit commitment template using the <code>PTDFPowerModel</code> network
formulation which only constructs the admittance matrix rows corresponding to "bounded" lines:</p>
<pre><code class="julia">template = template_unit_commitment(network=PTDFPowerModel)</code></pre>
<div class="code-output"><table>
  <caption style = "text-align: left;">Network Model</caption>
  <tbody>
    <tr>
      <td style = "text-align: left;">Network Model</td>
      <td style = "text-align: left;">PowerSimulations.PTDFPowerModel</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Slacks</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">PTDF</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Duals</td>
      <td style = "text-align: left;"></td>
    </tr>
  </tbody>
</table>

Device Models
┌───────────────────────────────────┬─────────────────────────────────────────────┬────────┐
│ Device Type                       │ Formulation                                 │ Slacks │
├───────────────────────────────────┼─────────────────────────────────────────────┼────────┤
│ PowerSystems.ThermalStandard      │ PowerSimulations.ThermalBasicUnitCommitment │ false  │
│ PowerSystems.HydroEnergyReservoir │ PowerSimulations.HydroDispatchRunOfRiver    │ false  │
│ PowerSystems.RenewableDispatch    │ PowerSimulations.RenewableFullDispatch      │ false  │
│ PowerSystems.PowerLoad            │ PowerSimulations.StaticPowerLoad            │ false  │
│ PowerSystems.InterruptibleLoad    │ PowerSimulations.InterruptiblePowerLoad     │ false  │
│ PowerSystems.RenewableFix         │ PowerSimulations.FixedOutput                │ false  │
│ PowerSystems.HydroDispatch        │ PowerSimulations.HydroDispatchRunOfRiver    │ false  │
└───────────────────────────────────┴─────────────────────────────────────────────┴────────┘

<table>
  <caption style = "text-align: left;">Branch Models</caption>
  <thead>
    <tr class = "header headerLastRow">
      <th style = "text-align: left;">Branch Type</th>
      <th style = "text-align: left;">Formulation</th>
      <th style = "text-align: left;">Slacks</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style = "text-align: left;">PowerSystems.Transformer2W</td>
      <td style = "text-align: left;">PowerSimulations.StaticBranch</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">PowerSystems.Line</td>
      <td style = "text-align: left;">PowerSimulations.StaticBranch</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">PowerSystems.HVDCLine</td>
      <td style = "text-align: left;">PowerSimulations.HVDCDispatch</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">PowerSystems.TapTransformer</td>
      <td style = "text-align: left;">PowerSimulations.StaticBranch</td>
      <td style = "text-align: left;">false</td>
    </tr>
  </tbody>
</table>

<table>
  <caption style = "text-align: left;">Service Models</caption>
  <thead>
    <tr class = "header headerLastRow">
      <th style = "text-align: left;">Service Type</th>
      <th style = "text-align: left;">Formulation</th>
      <th style = "text-align: left;">Slacks</th>
      <th style = "text-align: left;">Aggregated Model</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style = "text-align: left;">PowerSystems.VariableReserve{PowerSystems.ReserveUp}</td>
      <td style = "text-align: left;">PowerSimulations.RangeReserve</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">true</td>
    </tr>
    <tr>
      <td style = "text-align: left;">PowerSystems.VariableReserve{PowerSystems.ReserveDown}</td>
      <td style = "text-align: left;">PowerSimulations.RangeReserve</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">true</td>
    </tr>
  </tbody>
</table>
</div><p>Notice that there is no entry for <code>MonitoredLine</code>, so we can add one:</p>
<pre><code class="julia">set_device_model!(template, MonitoredLine, StaticBranch)</code></pre>
<p>We can also relax the formulation applied to the <code>Line</code> components to an unbounded flow formulation.
This formulation still enforces Kirchoff's laws, but does not apply flow constraints.</p>
<pre><code class="julia">set_device_model!(template, Line, StaticBranchUnbounded)</code></pre>
<h2 id="build_an_operationsproblem" ><a href="#build_an_operationsproblem"> Build an <code>OperationsProblem</code></a></h2><pre><code class="julia">uc_prob = DecisionModel(template, sys, horizon=24, optimizer=solver)
build!(uc_prob, output_dir=mktempdir())</code></pre>
<div class="code-output"><pre><code class="code-result language-plaintext">PowerSimulations.BuildStatusModule.BuildStatus.BUILT = 0</code></pre></div><p>Solve the relaxed problem</p>
<pre><code class="julia">solve!(uc_prob)</code></pre>
<div class="code-output"><pre><code class="code-result language-plaintext">PowerSimulations.RunStatusModule.RunStatus.SUCCESSFUL = 0</code></pre></div>
  <div class="page-foot">
  <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>
  "Dheepak Krishnamurthy".  Last modified: August 25, 2022. Website built with
  <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the
  <a href="https://julialang.org">Julia programming language</a>.
</div>

<script>
  var coll = document.getElementsByClassName('collapsible')
  var i

  for (i = 0; i < coll.length; i++) {
    coll[i].addEventListener('click', function () {
      this.classList.toggle('active')
      var content = this.nextElementSibling
      if (content.style.display === 'block') {
        content.style.display = 'none'
      } else {
        content.style.display = 'block'
      }
    })
  }
</script>



<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.4.0/clipboard.min.js"></script>

<script>
  ;(function () {
    // Get the elements.
    // - the 'pre' element.
    // - the 'div' with the 'paste-content' id.

    var pre = document.getElementsByTagName('pre')

    // Add a copy button in the 'pre' element.
    // which only has the className of 'language-'.

    for (var i = 0; i < pre.length; i++) {
      var isResult = pre[i].children[0].className.indexOf('code-result')
      var isStdout = pre[i].children[0].className.indexOf('code-stdout')

      if (isResult !== 0 && isStdout !== 0) {
        var button = document.createElement('button')
        button.className = 'copy-button'
        button.textContent = 'Copy'

        pre[i].prepend(button)
      }
    }

    // Run Clipboard

    var copyCode = new Clipboard('.copy-button', {
      target: function (trigger) {
        return trigger.nextElementSibling
      },
    })

    // On success:
    // - Change the "Copy" text to "Copied".
    // - Swap it to "Copy" in 2s.
    // - Lead user to the "contenteditable" area with Velocity scroll.

    copyCode.on('success', function (event) {
      event.clearSelection()
      event.trigger.textContent = 'Copied'
      window.setTimeout(function () {
        event.trigger.textContent = 'Copy'
      }, 2000)
    })

    // On error (Safari):
    // - Change the  "Press Ctrl+C to copy"
    // - Swap it to "Copy" in 2s.

    copyCode.on('error', function (event) {
      event.trigger.textContent = 'Press "Ctrl + C" to copy'
      window.setTimeout(function () {
        event.trigger.textContent = 'Copy'
      }, 5000)
    })
  })()
</script>

</div>

    
    
        <script src="/SIIP-Tutorial/libs/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>

    
  </body>

</html>
