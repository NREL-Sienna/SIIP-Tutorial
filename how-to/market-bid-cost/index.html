<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
   <link rel="stylesheet" href="/SIIP-Tutorial/libs/highlight/github.min.css">
   
  <link rel="stylesheet" href="/SIIP-Tutorial/css/franklin.css">
  <link rel="stylesheet" href="/SIIP-Tutorial/css/basic.css">
  <link rel="icon" href="/SIIP-Tutorial/assets/favicon.png">
  <title>SIIP Tutorial</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/1.33.1/plotly.min.js" integrity="sha512-V0j9LhrK9IMNdFYZqh+IqU4cjo7wdxyHNyH+L0td4HryBuZ7Oq6QxP2/CWr6TituX31+gv5PnolvERuTbz8UNA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
      const PlotlyJS_json = async (div, url) => {
        response = await fetch(url)
        fig = await response.json()
        if (typeof fig.config === 'undefined') { fig["config"]={} }
          delete fig.layout.width
          delete fig.layout.height
          fig["layout"]["autosize"] = true
          fig["config"]["autosizable"] = true
          fig["config"]["responsive"] = true
          fig.config["scrollZoom"] = false
          delete fig.config.staticPlot
          delete fig.config.displayModeBar
          delete fig.config.doubleClick
          delete fig.config.showTips
          Plotly.newPlot(div, fig);
      }
  </script>
</head>
<body>
  <header>
  <div class="blog-name"><a href="/SIIP-Tutorial/">SIIP Tutorial</a></div>
  <nav>
    <ul>
      <li><a href="/SIIP-Tutorial/">Home</a></li>
    </ul>
    <img src="/SIIP-Tutorial/assets/hamburger.svg" id="menu-icon" />
  </nav>
</header>



<div class="franklin-content" >
  <h1 id="time_varying_bid_problems_with_powersimulations.jl" ><a href="#time_varying_bid_problems_with_powersimulations.jl"> Time-varying bid problems with PowerSimulations.jl</a></h1><p><strong>Originally Contributed by</strong>: Sourabh Dalvi</p>
<h2 id="introduction" ><a href="#introduction"> Introduction</a></h2><p>PowerSimulations.jl supports the construction of Operations problems in power system
with three part cost bids for each time step. MarketBidCost allows the user to pass a
time-series of variable cost for energy and ancillary services jointly.
This example shows how to build a Operations problem with MarketBidCost and how to add
the time-series data to the devices.</p>
<h2 id="dependencies" ><a href="#dependencies"> Dependencies</a></h2><h3 id="modeling_packages" ><a href="#modeling_packages"> Modeling Packages</a></h3><pre><code class="julia">using PowerSystems
using PowerSimulations
const PSI = PowerSimulations</code></pre>
<div class="code-output"><pre><code class="code-result language-plaintext">PowerSimulations</code></pre></div><h3 id="data_management_packages" ><a href="#data_management_packages"> Data management packages</a></h3><pre><code class="julia">using PowerSystemCaseBuilder
using Dates
using DataFrames
using TimeSeries</code></pre>
<h3 id="optimization_packages" ><a href="#optimization_packages"> Optimization packages</a></h3><pre><code class="julia">using HiGHS #solver</code></pre>
<h3 id="data" ><a href="#data"> Data</a></h3><p>Create a <code>System</code> from RTS-GMLC data</p>
<pre><code class="julia">sys = build_system(PSITestSystems, &quot;modified_RTS_GMLC_DA_sys&quot;)</code></pre>
<div class="code-output"><table>
  <caption style = "text-align: left;">System</caption>
  <thead>
    <tr class = "header headerLastRow">
      <th style = "text-align: left;">Property</th>
      <th style = "text-align: left;">Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style = "text-align: left;">System Units Base</td>
      <td style = "text-align: left;">SYSTEM_BASE</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Base Power</td>
      <td style = "text-align: left;">100.0</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Base Frequency</td>
      <td style = "text-align: left;">60.0</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Num Components</td>
      <td style = "text-align: left;">500</td>
    </tr>
  </tbody>
</table>

<table>
  <caption style = "text-align: left;">Static Components</caption>
  <thead>
    <tr class = "header headerLastRow">
      <th style = "text-align: left;">Type</th>
      <th style = "text-align: left;">Count</th>
      <th style = "text-align: left;">Has Static Time Series</th>
      <th style = "text-align: left;">Has Forecasts</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style = "text-align: left;">Arc</td>
      <td style = "text-align: left;">109</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Area</td>
      <td style = "text-align: left;">3</td>
      <td style = "text-align: left;">true</td>
      <td style = "text-align: left;">true</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Bus</td>
      <td style = "text-align: left;">73</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">FixedAdmittance</td>
      <td style = "text-align: left;">3</td>
      <td style = "text-align: left;">true</td>
      <td style = "text-align: left;">true</td>
    </tr>
    <tr>
      <td style = "text-align: left;">HydroDispatch</td>
      <td style = "text-align: left;">1</td>
      <td style = "text-align: left;">true</td>
      <td style = "text-align: left;">true</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Line</td>
      <td style = "text-align: left;">105</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">LoadZone</td>
      <td style = "text-align: left;">21</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">PowerLoad</td>
      <td style = "text-align: left;">51</td>
      <td style = "text-align: left;">true</td>
      <td style = "text-align: left;">true</td>
    </tr>
    <tr>
      <td style = "text-align: left;">RenewableDispatch</td>
      <td style = "text-align: left;">29</td>
      <td style = "text-align: left;">true</td>
      <td style = "text-align: left;">true</td>
    </tr>
    <tr>
      <td style = "text-align: left;">RenewableFix</td>
      <td style = "text-align: left;">31</td>
      <td style = "text-align: left;">true</td>
      <td style = "text-align: left;">true</td>
    </tr>
    <tr>
      <td style = "text-align: left;">TapTransformer</td>
      <td style = "text-align: left;">15</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">ThermalStandard</td>
      <td style = "text-align: left;">54</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">VariableReserve{PowerSystems.ReserveDown}</td>
      <td style = "text-align: left;">1</td>
      <td style = "text-align: left;">true</td>
      <td style = "text-align: left;">true</td>
    </tr>
    <tr>
      <td style = "text-align: left;">VariableReserve{PowerSystems.ReserveUp}</td>
      <td style = "text-align: left;">4</td>
      <td style = "text-align: left;">true</td>
      <td style = "text-align: left;">true</td>
    </tr>
  </tbody>
</table>

<table>
  <caption style = "text-align: left;">Time Series Summary</caption>
  <thead>
    <tr class = "header headerLastRow">
      <th style = "text-align: left;">Property</th>
      <th style = "text-align: left;">Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style = "text-align: left;">Components with time series data</td>
      <td style = "text-align: left;">123</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Total StaticTimeSeries</td>
      <td style = "text-align: left;">124</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Total Forecasts</td>
      <td style = "text-align: left;">124</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Resolution</td>
      <td style = "text-align: left;">60 minutes</td>
    </tr>
    <tr>
      <td style = "text-align: left;">First initial time</td>
      <td style = "text-align: left;">2020-01-01T00:00:00</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Last initial time</td>
      <td style = "text-align: left;">2020-12-30T00:00:00</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Horizon</td>
      <td style = "text-align: left;">48</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Interval</td>
      <td style = "text-align: left;">1440 minutes</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Forecast window count</td>
      <td style = "text-align: left;">365</td>
    </tr>
  </tbody>
</table>
</div><h3 id="creating_the_time_series_data_for_energy_bid" ><a href="#creating_the_time_series_data_for_energy_bid"> Creating the Time Series data for Energy bid</a></h3><pre><code class="julia">MultiDay = collect(
    DateTime(&quot;2020-01-01T00:00:00&quot;):Hour(1):(DateTime(&quot;2020-01-01T00:00:00&quot;) + Hour(8783)),
);</code></pre>
<h3 id="adding_a_marketbidcost_time_series" ><a href="#adding_a_marketbidcost_time_series"> Adding a MarketBidCost time series</a></h3><p>Here we add the energy bid
time series to the system. The TimeSeriesData that holds the energy bid data can be of any
type (i.e. <code>SingleTimeSeries</code> or <code>Deterministic</code>), but it has to be consistent with the existing
data in the <code>sys</code>. So, we'll first remove the existing <code>DeterministicSingleTimeSeries</code>, then add
the bid time series as <code>SingleTimeSeries</code>, then re-transform all of the time series in <code>sys</code>.</p>
<pre><code class="julia">remove_time_series!(sys, DeterministicSingleTimeSeries)

for gen in get_components(ThermalGen, sys)
    varcost = get_operation_cost(gen)
    data = TimeArray(MultiDay, repeat([get_cost(get_variable(varcost))], 8784))
    _time_series = SingleTimeSeries(&quot;variable_cost&quot;, data)
    add_time_series!(sys, gen, _time_series)
    #set_variable_cost!(sys, gen, _time_series)
end</code></pre>
<h3 id="transforming_singletimeseries_into_deterministic" ><a href="#transforming_singletimeseries_into_deterministic"> Transforming SingleTimeSeries into Deterministic</a></h3><pre><code class="julia">transform_single_time_series!(sys, 24, Dates.Hour(24))</code></pre>
<p>In the <a href="https://nbviewer.jupyter.org/github/NREL-SIIP/SIIPExamples.jl/blob/master/notebook/3_PowerSimulations_examples/01_operations_problems.ipynb">OperationsProblem example</a>
we defined a unit-commitment problem with a copper plate representation of the network.
Here, we want do define unit-commitment problem  with ThermalMultiStartUnitCommitment
formulation for thermal device representation.</p>
<p>For now, let's just choose a standard UC formulation.</p>
<pre><code class="julia">uc_template = template_unit_commitment()</code></pre>
<div class="code-output"><table>
  <caption style = "text-align: left;">Network Model</caption>
  <tbody>
    <tr>
      <td style = "text-align: left;">Network Model</td>
      <td style = "text-align: left;">PowerSimulations.CopperPlatePowerModel</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Slacks</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">PTDF</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">Duals</td>
      <td style = "text-align: left;"></td>
    </tr>
  </tbody>
</table>

Device Models
┌───────────────────────────────────┬─────────────────────────────────────────────┬────────┐
│ Device Type                       │ Formulation                                 │ Slacks │
├───────────────────────────────────┼─────────────────────────────────────────────┼────────┤
│ PowerSystems.ThermalStandard      │ PowerSimulations.ThermalBasicUnitCommitment │ false  │
│ PowerSystems.HydroEnergyReservoir │ PowerSimulations.HydroDispatchRunOfRiver    │ false  │
│ PowerSystems.RenewableDispatch    │ PowerSimulations.RenewableFullDispatch      │ false  │
│ PowerSystems.PowerLoad            │ PowerSimulations.StaticPowerLoad            │ false  │
│ PowerSystems.InterruptibleLoad    │ PowerSimulations.InterruptiblePowerLoad     │ false  │
│ PowerSystems.RenewableFix         │ PowerSimulations.FixedOutput                │ false  │
│ PowerSystems.HydroDispatch        │ PowerSimulations.HydroDispatchRunOfRiver    │ false  │
└───────────────────────────────────┴─────────────────────────────────────────────┴────────┘

<table>
  <caption style = "text-align: left;">Branch Models</caption>
  <thead>
    <tr class = "header headerLastRow">
      <th style = "text-align: left;">Branch Type</th>
      <th style = "text-align: left;">Formulation</th>
      <th style = "text-align: left;">Slacks</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style = "text-align: left;">PowerSystems.Transformer2W</td>
      <td style = "text-align: left;">PowerSimulations.StaticBranch</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">PowerSystems.Line</td>
      <td style = "text-align: left;">PowerSimulations.StaticBranch</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">PowerSystems.HVDCLine</td>
      <td style = "text-align: left;">PowerSimulations.HVDCDispatch</td>
      <td style = "text-align: left;">false</td>
    </tr>
    <tr>
      <td style = "text-align: left;">PowerSystems.TapTransformer</td>
      <td style = "text-align: left;">PowerSimulations.StaticBranch</td>
      <td style = "text-align: left;">false</td>
    </tr>
  </tbody>
</table>

<table>
  <caption style = "text-align: left;">Service Models</caption>
  <thead>
    <tr class = "header headerLastRow">
      <th style = "text-align: left;">Service Type</th>
      <th style = "text-align: left;">Formulation</th>
      <th style = "text-align: left;">Slacks</th>
      <th style = "text-align: left;">Aggregated Model</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style = "text-align: left;">PowerSystems.VariableReserve{PowerSystems.ReserveUp}</td>
      <td style = "text-align: left;">PowerSimulations.RangeReserve</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">true</td>
    </tr>
    <tr>
      <td style = "text-align: left;">PowerSystems.VariableReserve{PowerSystems.ReserveDown}</td>
      <td style = "text-align: left;">PowerSimulations.RangeReserve</td>
      <td style = "text-align: left;">false</td>
      <td style = "text-align: left;">true</td>
    </tr>
  </tbody>
</table>
</div><p>And adjust the thermal generator formulation to use <code>ThermalMultiStartUnitCommitment</code></p>
<pre><code class="julia">set_device_model!(uc_template, ThermalMultiStart, ThermalMultiStartUnitCommitment)</code></pre>
<p>Now we can build a 4-hour economic dispatch problem with the RTS data.</p>
<pre><code class="julia">solver = optimizer_with_attributes(HiGHS.Optimizer, &quot;mip_rel_gap&quot; =&gt; 0.5)

problem = DecisionModel(uc_template, sys, horizon = 4, optimizer = solver)
build!(problem, output_dir = mktempdir())</code></pre>
<div class="code-output"><pre><code class="code-result language-plaintext">PowerSimulations.BuildStatusModule.BuildStatus.BUILT = 0</code></pre></div><p>And solve it ...</p>
<pre><code class="julia">solve!(problem)</code></pre>
<div class="code-output"><pre><code class="code-result language-plaintext">PowerSimulations.RunStatusModule.RunStatus.SUCCESSFUL = 0</code></pre></div>
  <div class="page-foot">
  <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>
  "Dheepak Krishnamurthy".  Last modified: August 25, 2022. Website built with
  <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the
  <a href="https://julialang.org">Julia programming language</a>.
</div>

<script>
  var coll = document.getElementsByClassName('collapsible')
  var i

  for (i = 0; i < coll.length; i++) {
    coll[i].addEventListener('click', function () {
      this.classList.toggle('active')
      var content = this.nextElementSibling
      if (content.style.display === 'block') {
        content.style.display = 'none'
      } else {
        content.style.display = 'block'
      }
    })
  }
</script>



<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.4.0/clipboard.min.js"></script>

<script>
  ;(function () {
    // Get the elements.
    // - the 'pre' element.
    // - the 'div' with the 'paste-content' id.

    var pre = document.getElementsByTagName('pre')

    // Add a copy button in the 'pre' element.
    // which only has the className of 'language-'.

    for (var i = 0; i < pre.length; i++) {
      var isResult = pre[i].children[0].className.indexOf('code-result')
      var isStdout = pre[i].children[0].className.indexOf('code-stdout')

      if (isResult !== 0 && isStdout !== 0) {
        var button = document.createElement('button')
        button.className = 'copy-button'
        button.textContent = 'Copy'

        pre[i].prepend(button)
      }
    }

    // Run Clipboard

    var copyCode = new Clipboard('.copy-button', {
      target: function (trigger) {
        return trigger.nextElementSibling
      },
    })

    // On success:
    // - Change the "Copy" text to "Copied".
    // - Swap it to "Copy" in 2s.
    // - Lead user to the "contenteditable" area with Velocity scroll.

    copyCode.on('success', function (event) {
      event.clearSelection()
      event.trigger.textContent = 'Copied'
      window.setTimeout(function () {
        event.trigger.textContent = 'Copy'
      }, 2000)
    })

    // On error (Safari):
    // - Change the  "Press Ctrl+C to copy"
    // - Swap it to "Copy" in 2s.

    copyCode.on('error', function (event) {
      event.trigger.textContent = 'Press "Ctrl + C" to copy'
      window.setTimeout(function () {
        event.trigger.textContent = 'Copy'
      }, 5000)
    })
  })()
</script>

</div>

    
    
        <script src="/SIIP-Tutorial/libs/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>

    
  </body>

</html>
